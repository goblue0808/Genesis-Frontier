<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Genesis Frontier - Test Suite</title>
    <style>
        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: #1a1a2e;
            color: #eee;
            padding: 20px;
            max-width: 1200px;
            margin: 0 auto;
        }
        h1 {
            color: #4CAF50;
            text-align: center;
        }
        .test-section {
            background: #16213e;
            padding: 20px;
            margin: 20px 0;
            border-radius: 10px;
            border-left: 4px solid #4CAF50;
        }
        .test-case {
            margin: 15px 0;
            padding: 10px;
            background: rgba(255, 255, 255, 0.05);
            border-radius: 5px;
        }
        .pass {
            color: #4CAF50;
            font-weight: bold;
        }
        .fail {
            color: #f44336;
            font-weight: bold;
        }
        .test-result {
            display: inline-block;
            padding: 5px 10px;
            border-radius: 3px;
            margin-left: 10px;
        }
        .test-result.pass {
            background: rgba(76, 175, 80, 0.2);
        }
        .test-result.fail {
            background: rgba(244, 67, 54, 0.2);
        }
        button {
            background: #4CAF50;
            color: white;
            border: none;
            padding: 15px 30px;
            border-radius: 5px;
            font-size: 16px;
            cursor: pointer;
            display: block;
            margin: 20px auto;
        }
        button:hover {
            background: #45a049;
        }
        #results {
            margin-top: 20px;
        }
        .summary {
            background: #0f3460;
            padding: 15px;
            border-radius: 5px;
            text-align: center;
            margin: 20px 0;
            font-size: 1.2em;
        }
    </style>
</head>
<body>
    <h1>üß™ Genesis Frontier - Test Suite</h1>
    <p style="text-align: center; opacity: 0.8;">Automated tests for the multi-stage terraforming system</p>
    
    <button onclick="runAllTests()">Run All Tests</button>
    
    <div id="results"></div>

    <script src="game.js"></script>
    <script>
        let testsPassed = 0;
        let testsFailed = 0;

        function runAllTests() {
            testsPassed = 0;
            testsFailed = 0;
            const resultsDiv = document.getElementById('results');
            resultsDiv.innerHTML = '';

            // Run test suites
            testGameInitialization();
            testFacilityMechanics();
            testStageProgression();
            testEnvironmentalCollapse();
            testResourceManagement();
            testPlanetTypes();
            testBuildingUnlocks();

            // Display summary
            displaySummary();
        }

        function assert(condition, testName, details = '') {
            const testCase = document.createElement('div');
            testCase.className = 'test-case';
            
            if (condition) {
                testsPassed++;
                testCase.innerHTML = `
                    <span class="pass">‚úì</span> ${testName}
                    <span class="test-result pass">PASS</span>
                    ${details ? `<div style="margin-top: 5px; opacity: 0.8; font-size: 0.9em;">${details}</div>` : ''}
                `;
            } else {
                testsFailed++;
                testCase.innerHTML = `
                    <span class="fail">‚úó</span> ${testName}
                    <span class="test-result fail">FAIL</span>
                    ${details ? `<div style="margin-top: 5px; opacity: 0.8; font-size: 0.9em; color: #f44336;">${details}</div>` : ''}
                `;
            }
            
            document.getElementById('results').appendChild(testCase);
        }

        function createTestSection(title) {
            const section = document.createElement('div');
            section.className = 'test-section';
            section.innerHTML = `<h2>${title}</h2>`;
            document.getElementById('results').appendChild(section);
            return section;
        }

        function testGameInitialization() {
            createTestSection('üéÆ Game Initialization Tests');
            
            const game = new TerraformingGame();
            
            assert(game !== null, 'Game instance created successfully');
            assert(game.turn === 0, 'Game starts at turn 0', `Turn: ${game.turn}`);
            assert(game.resources.credits === 5000, 'Starting credits are 5000', `Credits: ${game.resources.credits}`);
            assert(game.resources.energy === 200, 'Starting energy is 200', `Energy: ${game.resources.energy}`);
            assert(game.resources.population === 0, 'Starting population is 0', `Population: ${game.resources.population}`);
            assert(Object.keys(game.facilityTypes).length === 11, 'All 11 facility types are defined', `Found: ${Object.keys(game.facilityTypes).length}`);
            assert(game.stages.length === 6, 'All 6 terraforming stages are defined', `Found: ${game.stages.length}`);
        }

        function testFacilityMechanics() {
            createTestSection('üè≠ Facility Mechanics Tests');
            
            const game = new TerraformingGame();
            
            // Test heating facility
            const heatingFacility = game.facilityTypes.heatingFacility;
            assert(heatingFacility !== undefined, 'Heating Facility exists');
            assert(heatingFacility.effects.temperature === 5, 'Heating Facility increases temperature by 5', `Effect: ${heatingFacility.effects.temperature}`);
            assert(heatingFacility.effects.water === 3, 'Heating Facility melts ice (water +3)', `Effect: ${heatingFacility.effects.water}`);
            
            // Test cooling facility
            const coolingFacility = game.facilityTypes.coolingFacility;
            assert(coolingFacility !== undefined, 'Cooling Facility exists');
            assert(coolingFacility.effects.temperature === -5, 'Cooling Facility decreases temperature by 5', `Effect: ${coolingFacility.effects.temperature}`);
            
            // Test O2 generator
            const o2Facility = game.facilityTypes.oxygenFacility;
            assert(o2Facility !== undefined, 'O2 Generator exists');
            assert(o2Facility.effects.oxygen === 4, 'O2 Generator increases oxygen by 4', `Effect: ${o2Facility.effects.oxygen}`);
            assert(o2Facility.effects.co2 === -2, 'O2 Generator reduces CO2 by 2', `Effect: ${o2Facility.effects.co2}`);
            
            // Test CO2 scrubber
            const co2Scrubber = game.facilityTypes.co2Scrubber;
            assert(co2Scrubber !== undefined, 'CO2 Scrubber exists');
            assert(co2Scrubber.effects.co2 === -5, 'CO2 Scrubber reduces CO2 by 5', `Effect: ${co2Scrubber.effects.co2}`);
            assert(co2Scrubber.effects.pollution === -3, 'CO2 Scrubber reduces pollution by 3', `Effect: ${co2Scrubber.effects.pollution}`);
        }

        function testStageProgression() {
            createTestSection('üìà Stage Progression Tests');
            
            const game = new TerraformingGame();
            
            // Test initial stage
            const initialStage = game.getCurrentStage();
            assert(initialStage >= 0, 'Game starts at valid stage', `Stage: ${initialStage}`);
            
            // Test stage requirements
            assert(game.stages[0].name === 'Stage 0: Hostile World', 'Stage 0 is "Hostile World"');
            assert(game.stages[1].requirements.temperature === -20, 'Stage 1 requires temperature >= -20¬∞C');
            assert(game.stages[2].requirements.oxygen === 20, 'Stage 2 requires oxygen >= 20%');
            assert(game.stages[5].name === 'Stage 5: Thriving Colony', 'Stage 5 is "Thriving Colony" (victory)');
            
            // Test that stages unlock buildings
            assert(game.stages[0].unlocksBuildings.includes('heatingFacility'), 'Stage 0 unlocks Heating Facility');
            assert(game.stages[0].unlocksBuildings.includes('coolingFacility'), 'Stage 0 unlocks Cooling Facility');
            assert(game.stages[1].unlocksBuildings.includes('oxygenFacility'), 'Stage 1 unlocks O2 Generator');
        }

        function testEnvironmentalCollapse() {
            createTestSection('üíÄ Environmental Collapse Tests');
            
            const game = new TerraformingGame();
            
            // Test extreme cold collapse
            game.planet.temperature = -60;
            game.checkEnvironmentalCollapse();
            assert(game.collapsed === true, 'Extreme cold triggers environmental collapse', `Temp: ${game.planet.temperature}¬∞C`);
            
            // Reset and test extreme heat
            game.collapsed = false;
            game.planet.temperature = 110;
            game.checkEnvironmentalCollapse();
            assert(game.collapsed === true, 'Extreme heat triggers environmental collapse', `Temp: ${game.planet.temperature}¬∞C`);
            
            // Reset and test toxic CO2
            game.collapsed = false;
            game.planet.temperature = 20;
            game.planet.co2 = 96;
            game.checkEnvironmentalCollapse();
            assert(game.collapsed === true, 'Toxic CO2 levels trigger environmental collapse', `CO2: ${game.planet.co2}%`);
            
            // Reset and test pollution crisis
            game.collapsed = false;
            game.planet.co2 = 50;
            game.planet.pollution = 91;
            game.checkEnvironmentalCollapse();
            assert(game.collapsed === true, 'Extreme pollution triggers environmental collapse', `Pollution: ${game.planet.pollution}%`);
        }

        function testResourceManagement() {
            createTestSection('üí∞ Resource Management Tests');
            
            const game = new TerraformingGame();
            
            // Test building costs
            const canAffordHeating = game.canAfford('heatingFacility');
            assert(canAffordHeating === true, 'Player can afford Heating Facility initially', `Credits: ${game.resources.credits}, Energy: ${game.resources.energy}`);
            
            // Test buying facility
            const initialCredits = game.resources.credits;
            const initialEnergy = game.resources.energy;
            game.buyFacility('heatingFacility');
            
            assert(game.facilities.heatingFacility === 1, 'Heating Facility purchased successfully', `Count: ${game.facilities.heatingFacility}`);
            assert(game.resources.credits === initialCredits - 1000, 'Credits deducted correctly', `Expected: ${initialCredits - 1000}, Got: ${game.resources.credits}`);
            assert(game.resources.energy === initialEnergy - 50, 'Energy deducted correctly', `Expected: ${initialEnergy - 50}, Got: ${game.resources.energy}`);
            
            // Test energy production/consumption
            game.facilities.solarArray = 1;
            let energyProduction = 100; // Base
            let energyConsumption = 0;
            energyProduction += 50; // Solar array
            energyConsumption += 20; // Heating facility
            assert(energyProduction - energyConsumption === 130, 'Energy balance calculated correctly', `Net: ${energyProduction - energyConsumption}`);
        }

        function testPlanetTypes() {
            createTestSection('üåç Planet Types Tests');
            
            const game = new TerraformingGame();
            
            // Test all planet types exist
            assert(game.planetTypes.cold !== undefined, 'Cold planet type exists');
            assert(game.planetTypes.hot !== undefined, 'Hot planet type exists');
            assert(game.planetTypes.desert !== undefined, 'Desert planet type exists');
            assert(game.planetTypes.barren !== undefined, 'Barren planet type exists');
            
            // Test cold planet characteristics
            const coldPlanet = game.planetTypes.cold;
            assert(coldPlanet.initialStats.temperature < 0, 'Cold planet has negative temperature', `Temp: ${coldPlanet.initialStats.temperature}¬∞C`);
            assert(coldPlanet.initialStats.water > 0, 'Cold planet has frozen water', `Water: ${coldPlanet.initialStats.water}%`);
            
            // Test hot planet characteristics
            const hotPlanet = game.planetTypes.hot;
            assert(hotPlanet.initialStats.temperature > 100, 'Hot planet has high temperature', `Temp: ${hotPlanet.initialStats.temperature}¬∞C`);
            assert(hotPlanet.initialStats.water < 10, 'Hot planet has low water', `Water: ${hotPlanet.initialStats.water}%`);
        }

        function testBuildingUnlocks() {
            createTestSection('üîì Building Unlock Tests');
            
            const game = new TerraformingGame();
            
            // Force planet to be cold (starts at Stage 0)
            game.currentPlanetType = 'cold';
            game.planet = JSON.parse(JSON.stringify(game.planetTypes.cold.initialStats));
            
            // Test Stage 0 unlocks
            assert(game.isBuildingUnlocked('heatingFacility') === true, 'Heating Facility unlocked at Stage 0');
            assert(game.isBuildingUnlocked('coolingFacility') === true, 'Cooling Facility unlocked at Stage 0');
            assert(game.isBuildingUnlocked('solarArray') === true, 'Solar Array unlocked at Stage 0');
            
            // Test locked buildings at Stage 0
            const currentStage = game.getCurrentStage();
            assert(game.isBuildingUnlocked('oxygenFacility') === false, 'O2 Generator locked at Stage 0', `Current Stage: ${currentStage}`);
            assert(game.isBuildingUnlocked('co2Scrubber') === false, 'CO2 Scrubber locked at Stage 0');
            assert(game.isBuildingUnlocked('greenhouse') === false, 'Greenhouse locked at Stage 0');
            assert(game.isBuildingUnlocked('habitatDome') === false, 'Habitat Dome locked at Stage 0');
            
            // Simulate reaching Stage 1
            game.currentPlanetType = 'hot'; // Hot planets start closer to Stage 1
            game.planet.temperature = 0; // Meet Stage 1 requirement
            const stage = game.getCurrentStage();
            assert(stage >= 1, 'Can reach Stage 1 with appropriate conditions', `Stage: ${stage}`);
        }

        function displaySummary() {
            const summary = document.createElement('div');
            summary.className = 'summary';
            const total = testsPassed + testsFailed;
            const percentage = total > 0 ? ((testsPassed / total) * 100).toFixed(1) : 0;
            
            summary.innerHTML = `
                <h2>Test Summary</h2>
                <p><strong>${testsPassed}</strong> tests passed, <strong>${testsFailed}</strong> tests failed out of <strong>${total}</strong> total</p>
                <p>Success rate: <strong>${percentage}%</strong></p>
                ${testsFailed === 0 ? '<p style="color: #4CAF50; font-size: 1.5em;">üéâ All tests passed!</p>' : '<p style="color: #f44336;">‚ö†Ô∏è Some tests failed. Please review above.</p>'}
            `;
            
            document.getElementById('results').insertBefore(summary, document.getElementById('results').firstChild);
        }

        // Run tests on load
        window.addEventListener('DOMContentLoaded', () => {
            console.log('Test suite loaded. Click "Run All Tests" to begin.');
        });
    </script>
</body>
</html>
