<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Genesis Frontier - Multiplayer Universe</title>
    <link rel="stylesheet" href="styles.css">
    <style>
        .tab-container {
            display: flex;
            background: #0f3460;
            border-radius: 5px;
            margin: 20px 0;
            overflow: hidden;
        }
        
        .tab-button {
            flex: 1;
            padding: 15px;
            background: transparent;
            border: none;
            color: #eee;
            cursor: pointer;
            transition: background 0.3s;
            font-size: 16px;
        }
        
        .tab-button:hover {
            background: rgba(255, 255, 255, 0.1);
        }
        
        .tab-button.active {
            background: #16213e;
            border-bottom: 3px solid #4CAF50;
        }
        
        .tab-content {
            display: none;
        }
        
        .tab-content.active {
            display: block;
        }
        
        .galaxy-map {
            background: #000;
            border: 2px solid #16213e;
            border-radius: 10px;
            padding: 20px;
            min-height: 400px;
            position: relative;
        }
        
        .system-node {
            position: absolute;
            width: 40px;
            height: 40px;
            background: radial-gradient(circle, #ffd700 0%, #ff8c00 100%);
            border-radius: 50%;
            cursor: pointer;
            transition: transform 0.2s;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 24px;
        }
        
        .system-node:hover {
            transform: scale(1.3);
        }
        
        .system-node.discovered {
            background: radial-gradient(circle, #4CAF50 0%, #2E7D32 100%);
        }
        
        .system-node.colonized {
            background: radial-gradient(circle, #2196F3 0%, #1565C0 100%);
            box-shadow: 0 0 20px rgba(33, 150, 243, 0.8);
        }
        
        .ship-list {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(300px, 1fr));
            gap: 15px;
        }
        
        .ship-card {
            background: #16213e;
            padding: 15px;
            border-radius: 8px;
            border-left: 4px solid #4CAF50;
        }
        
        .ship-card.traveling {
            border-left-color: #FF9800;
        }
        
        .construction-queue {
            background: #16213e;
            padding: 15px;
            border-radius: 8px;
            margin: 10px 0;
        }
        
        .progress-bar-construct {
            width: 100%;
            height: 20px;
            background: rgba(255, 255, 255, 0.1);
            border-radius: 10px;
            overflow: hidden;
            margin: 10px 0;
        }
        
        .progress-fill-construct {
            height: 100%;
            background: linear-gradient(90deg, #4CAF50 0%, #8BC34A 100%);
            transition: width 0.3s;
        }
        
        .diplomacy-panel {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(250px, 1fr));
            gap: 15px;
        }
        
        .player-card {
            background: #16213e;
            padding: 15px;
            border-radius: 8px;
        }
        
        .player-card.allied {
            border: 2px solid #4CAF50;
        }
        
        .player-card.war {
            border: 2px solid #f44336;
        }
        
        .planet-selector {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(200px, 1fr));
            gap: 10px;
            margin: 15px 0;
        }
        
        .planet-card {
            background: #0f3460;
            padding: 12px;
            border-radius: 6px;
            cursor: pointer;
            transition: all 0.3s;
            border: 2px solid transparent;
        }
        
        .planet-card:hover {
            border-color: #4CAF50;
            transform: translateY(-2px);
        }
        
        .planet-card.selected {
            border-color: #4CAF50;
            background: #16213e;
        }
        
        .prestige-display {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            padding: 20px;
            border-radius: 10px;
            text-align: center;
            margin: 20px 0;
        }
        
        .prestige-rank {
            font-size: 2em;
            font-weight: bold;
            text-shadow: 2px 2px 4px rgba(0, 0, 0, 0.5);
        }
        
        .mega-project-card {
            background: linear-gradient(135deg, #f093fb 0%, #f5576c 100%);
            padding: 20px;
            border-radius: 10px;
            margin: 15px 0;
            color: white;
        }
    </style>
</head>
<body>
    <div class="game-container">
        <header>
            <h1>üåå Genesis Frontier - Multiplayer Universe</h1>
            <p class="subtitle">Build Your Galactic Empire</p>
        </header>

        <!-- Player Stats Bar -->
        <div class="panel">
            <div class="resource-grid" style="grid-template-columns: repeat(auto-fit, minmax(150px, 1fr));">
                <div class="resource-item">
                    <span class="resource-icon">üë§</span>
                    <span id="player-name">Commander</span>
                </div>
                <div class="resource-item">
                    <span class="resource-icon">üí∞</span>
                    <span class="resource-label">Credits:</span>
                    <span id="mp-credits">0</span>
                </div>
                <div class="resource-item">
                    <span class="resource-icon">‚ö°</span>
                    <span class="resource-label">Energy:</span>
                    <span id="mp-energy">0</span>
                </div>
                <div class="resource-item">
                    <span class="resource-icon">üî©</span>
                    <span class="resource-label">Metals:</span>
                    <span id="mp-metals">0</span>
                </div>
                <div class="resource-item">
                    <span class="resource-icon">üíé</span>
                    <span class="resource-label">Rare Resources:</span>
                    <span id="mp-rare">0</span>
                </div>
                <div class="resource-item">
                    <span class="resource-icon">‚≠ê</span>
                    <span class="resource-label">Prestige:</span>
                    <span id="mp-prestige">0</span>
                </div>
                <div class="resource-item">
                    <span class="resource-icon">üåç</span>
                    <span class="resource-label">Planets:</span>
                    <span id="mp-planets">0</span>
                </div>
                <div class="resource-item">
                    <span class="resource-icon">üöÄ</span>
                    <span class="resource-label">Ships:</span>
                    <span id="mp-ships">0</span>
                </div>
            </div>
        </div>

        <!-- Prestige and Rank Display -->
        <div id="prestige-panel" class="prestige-display">
            <div>Your Rank</div>
            <div class="prestige-rank" id="prestige-rank">Explorer</div>
            <div style="margin-top: 10px; opacity: 0.9;">Turn <span id="mp-turn">0</span></div>
        </div>

        <!-- Tab Navigation -->
        <div class="tab-container">
            <button class="tab-button active" onclick="switchTab('overview')">üè† Overview</button>
            <button class="tab-button" onclick="switchTab('galaxy')">üåå Galaxy Map</button>
            <button class="tab-button" onclick="switchTab('fleet')">üöÄ Fleet</button>
            <button class="tab-button" onclick="switchTab('planets')">üåç Planets</button>
            <button class="tab-button" onclick="switchTab('diplomacy')">ü§ù Diplomacy</button>
            <button class="tab-button" onclick="switchTab('megaprojects')">üèóÔ∏è Mega-Projects</button>
        </div>

        <!-- Overview Tab -->
        <div id="overview-tab" class="tab-content active">
            <div class="panel">
                <h2>Empire Overview</h2>
                <div id="overview-content"></div>
            </div>
            
            <div class="panel">
                <h2>Recent Events</h2>
                <div id="mp-alerts-list" class="alerts-list"></div>
            </div>
        </div>

        <!-- Galaxy Map Tab -->
        <div id="galaxy-tab" class="tab-content">
            <div class="panel">
                <h2>Galaxy Map</h2>
                <p>Explore the universe and discover new star systems</p>
                <div id="galaxy-map" class="galaxy-map"></div>
                <div id="system-details" style="margin-top: 20px;"></div>
            </div>
        </div>

        <!-- Fleet Tab -->
        <div id="fleet-tab" class="tab-content">
            <div class="panel">
                <h2>Shipyard</h2>
                <p>Construct new starships to explore, trade, and conquer</p>
                
                <div id="shipyard-queue"></div>
                
                <h3 style="margin-top: 20px;">Available Ship Types</h3>
                <div id="ship-types-list" class="buildings-grid"></div>
            </div>
            
            <div class="panel">
                <h2>Your Fleet</h2>
                <div id="fleet-list" class="ship-list"></div>
            </div>
        </div>

        <!-- Planets Tab -->
        <div id="planets-tab" class="tab-content">
            <div class="panel">
                <h2>Your Colonies</h2>
                <p>Manage your colonized planets</p>
                <div id="planets-list"></div>
            </div>
        </div>

        <!-- Diplomacy Tab -->
        <div id="diplomacy-tab" class="tab-content">
            <div class="panel">
                <h2>Diplomatic Relations</h2>
                <p>Manage relationships with other players</p>
                
                <div style="margin: 20px 0;">
                    <h3>Actions</h3>
                    <button class="btn btn-primary" onclick="game.sendSpy('ai_player_1')">üïµÔ∏è Send Spy Mission (5000 credits)</button>
                </div>
                
                <h3>Other Players</h3>
                <div id="diplomacy-list" class="diplomacy-panel"></div>
            </div>
            
            <div class="panel">
                <h2>Trade & Warfare</h2>
                <div style="display: grid; gap: 15px;">
                    <div>
                        <h3>Establish Trade Route</h3>
                        <p>Transfer resources between your planets</p>
                        <button class="btn btn-secondary" onclick="showTradeRouteDialog()">Create Trade Route</button>
                    </div>
                    
                    <div>
                        <h3>Military Actions</h3>
                        <p>‚ö†Ô∏è Requires at least 2 colonized planets to invade</p>
                        <div id="invasion-options"></div>
                    </div>
                </div>
            </div>
        </div>

        <!-- Mega-Projects Tab -->
        <div id="megaprojects-tab" class="tab-content">
            <div class="panel">
                <h2>Mega-Projects</h2>
                <p>Construct monumental structures that define your legacy</p>
                
                <div id="active-megaprojects"></div>
                
                <h3 style="margin-top: 30px;">Available Mega-Projects</h3>
                <div id="megaproject-options"></div>
            </div>
        </div>

        <!-- Controls -->
        <div class="controls">
            <button id="mp-next-turn" class="btn btn-primary" style="font-size: 1.2em; padding: 20px 40px;">‚è≠Ô∏è Next Turn</button>
            <button id="mp-save" class="btn btn-secondary">üíæ Save Game</button>
            <button id="mp-reset" class="btn btn-secondary">üîÑ New Game</button>
        </div>
    </div>

    <script src="game.js"></script>
    <script src="multiplayer.js"></script>
    <script>
        let game;
        let selectedPlanetIndex = 0;

        function switchTab(tabName) {
            // Hide all tabs
            document.querySelectorAll('.tab-content').forEach(tab => {
                tab.classList.remove('active');
            });
            
            // Remove active from all buttons
            document.querySelectorAll('.tab-button').forEach(btn => {
                btn.classList.remove('active');
            });
            
            // Show selected tab
            document.getElementById(`${tabName}-tab`).classList.add('active');
            
            // Set button active
            event.target.classList.add('active');
            
            // Update content for the tab
            if (tabName === 'galaxy') updateGalaxyMap();
            if (tabName === 'fleet') updateFleetTab();
            if (tabName === 'planets') updatePlanetsTab();
            if (tabName === 'diplomacy') updateDiplomacyTab();
            if (tabName === 'megaprojects') updateMegaProjectsTab();
            if (tabName === 'overview') updateOverviewTab();
        }

        function updateUI() {
            if (!game) return;
            
            // Update stats
            document.getElementById('player-name').textContent = game.playerName;
            document.getElementById('mp-credits').textContent = Math.floor(game.resources.credits);
            document.getElementById('mp-energy').textContent = Math.floor(game.resources.energy);
            document.getElementById('mp-metals').textContent = Math.floor(game.resources.metals);
            document.getElementById('mp-rare').textContent = Math.floor(game.resources.rareResources);
            document.getElementById('mp-prestige').textContent = Math.floor(game.resources.prestige);
            document.getElementById('mp-planets').textContent = game.ownedPlanets.length;
            document.getElementById('mp-ships').textContent = game.starships.length;
            document.getElementById('mp-turn').textContent = game.turn;
            
            // Update rank
            const rank = game.calculatePrestigeRank();
            document.getElementById('prestige-rank').textContent = rank;
            
            // Update alerts
            updateAlertsList();
        }

        function updateAlertsList() {
            const container = document.getElementById('mp-alerts-list');
            container.innerHTML = '';

            if (game.alerts.length === 0) {
                container.innerHTML = '<p style="opacity: 0.6;">No recent events</p>';
                return;
            }

            game.alerts.slice(0, 10).forEach(alert => {
                const alertDiv = document.createElement('div');
                alertDiv.className = `alert-item ${alert.type}`;
                alertDiv.innerHTML = `<strong>[Turn ${alert.turn}]</strong> ${alert.message}`;
                container.appendChild(alertDiv);
            });
        }

        function updateOverviewTab() {
            const container = document.getElementById('overview-content');
            const html = `
                <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(250px, 1fr)); gap: 20px;">
                    <div class="stat-item" style="background: #16213e; padding: 20px; border-radius: 8px;">
                        <h3>üåç Empire Size</h3>
                        <p style="font-size: 2em; font-weight: bold;">${game.ownedPlanets.length}</p>
                        <p>Colonized Planets</p>
                    </div>
                    
                    <div class="stat-item" style="background: #16213e; padding: 20px; border-radius: 8px;">
                        <h3>üöÄ Fleet Strength</h3>
                        <p style="font-size: 2em; font-weight: bold;">${game.starships.length}</p>
                        <p>Active Starships</p>
                    </div>
                    
                    <div class="stat-item" style="background: #16213e; padding: 20px; border-radius: 8px;">
                        <h3>üåå Exploration</h3>
                        <p style="font-size: 2em; font-weight: bold;">${game.exploredSystems.length}</p>
                        <p>Systems Discovered</p>
                    </div>
                    
                    <div class="stat-item" style="background: #16213e; padding: 20px; border-radius: 8px;">
                        <h3>üë• Population</h3>
                        <p style="font-size: 2em; font-weight: bold;">${game.ownedPlanets.reduce((sum, p) => sum + p.resources.population, 0)}</p>
                        <p>Total Citizens</p>
                    </div>
                </div>
                
                <div style="margin-top: 30px;">
                    <h3>Active Construction</h3>
                    ${game.shipyardQueue.length > 0 ? 
                        `<p>${game.shipyardQueue.length} ships under construction</p>` :
                        '<p style="opacity: 0.6;">No ships currently under construction</p>'
                    }
                    ${game.megaProjects.length > 0 ?
                        `<p>${game.megaProjects.length} mega-projects in progress</p>` :
                        '<p style="opacity: 0.6;">No mega-projects in progress</p>'
                    }
                </div>
            `;
            container.innerHTML = html;
        }

        function updateGalaxyMap() {
            const container = document.getElementById('galaxy-map');
            container.innerHTML = '';
            container.style.width = '600px';
            container.style.height = '600px';
            container.style.position = 'relative';
            container.style.margin = '0 auto';

            // Draw star systems
            game.galaxyMap.systems.forEach(system => {
                const node = document.createElement('div');
                node.className = 'system-node';
                
                if (!system.discovered) {
                    node.className += ' undiscovered';
                    node.style.background = 'radial-gradient(circle, #444 0%, #222 100%)';
                } else if (system.planets.some(p => p.owner === game.playerId)) {
                    node.className += ' colonized';
                } else {
                    node.className += ' discovered';
                }
                
                node.style.left = (system.position.x * 60) + '%';
                node.style.top = (system.position.y * 60) + '%';
                node.textContent = system.discovered ? '‚≠ê' : '‚ùì';
                node.title = system.discovered ? system.name : 'Unknown System';
                
                node.onclick = () => showSystemDetails(system);
                
                container.appendChild(node);
            });
        }

        function showSystemDetails(system) {
            const container = document.getElementById('system-details');
            
            if (!system.discovered) {
                container.innerHTML = '<p>This system has not been explored yet. Send a scout ship to discover it!</p>';
                return;
            }
            
            let html = `
                <div class="panel" style="background: #16213e;">
                    <h3>${system.name}</h3>
                    <p><strong>Location:</strong> Sector ${system.position.x},${system.position.y}</p>
                    <p><strong>Planets:</strong> ${system.planets.length}</p>
                    
                    <h4 style="margin-top: 20px;">Planets in this system:</h4>
                    <div class="planet-selector">
            `;
            
            system.planets.forEach(planet => {
                const planetType = game.planetTypes[planet.type];
                html += `
                    <div class="planet-card">
                        <div><strong>${planetType.icon} ${planet.name}</strong></div>
                        <div style="font-size: 0.9em; opacity: 0.8;">${planetType.name}</div>
                        <div style="margin-top: 5px;">
                            ${planet.colonized ? 
                                `<span style="color: #4CAF50;">Colonized</span>` :
                                `<button class="btn btn-primary btn-small" onclick="colonizePlanetFromMap('${system.id}', '${planet.id}')" ${game.starships.some(s => s.type === 'colony' && s.currentLocation === system.id) ? '' : 'disabled'}>
                                    Colonize
                                </button>`
                            }
                        </div>
                        ${planet.hasRareResources ? '<div style="color: #FFD700; margin-top: 5px;">üíé Rare Resources</div>' : ''}
                    </div>
                `;
            });
            
            html += `
                    </div>
                    
                    <div style="margin-top: 20px;">
                        <h4>Send Ship to System:</h4>
                        <select id="ship-select" class="btn">
                            <option value="">-- Select a ship --</option>
            `;
            
            game.starships.filter(s => !s.traveling).forEach(ship => {
                html += `<option value="${ship.id}">${ship.icon} ${ship.name} (${ship.type})</option>`;
            });
            
            html += `
                        </select>
                        <button class="btn btn-primary" onclick="sendShipToSystem('${system.id}')">Send Ship</button>
                    </div>
                </div>
            `;
            
            container.innerHTML = html;
        }

        function sendShipToSystem(systemId) {
            const select = document.getElementById('ship-select');
            const shipId = select.value;
            
            if (!shipId) {
                alert('Please select a ship');
                return;
            }
            
            game.exploreSystem(shipId, systemId);
            updateUI();
            updateGalaxyMap();
        }

        function colonizePlanetFromMap(systemId, planetId) {
            const colonyShip = game.starships.find(s => s.type === 'colony' && s.currentLocation === systemId);
            
            if (!colonyShip) {
                alert('No colony ship available at this system');
                return;
            }
            
            game.colonizePlanet(colonyShip.id, systemId, planetId);
            updateUI();
            updateGalaxyMap();
        }

        function updateFleetTab() {
            // Update shipyard queue
            const queueContainer = document.getElementById('shipyard-queue');
            if (game.shipyardQueue.length > 0) {
                let queueHtml = '<h3>Under Construction</h3>';
                game.shipyardQueue.forEach(construction => {
                    const shipType = game.starshipTypes[construction.type];
                    const progress = ((game.turn + construction.progress) / construction.completionTurn) * 100;
                    queueHtml += `
                        <div class="construction-queue">
                            <strong>${shipType.icon} ${shipType.name}</strong>
                            <div>Completion: Turn ${construction.completionTurn} (${construction.completionTurn - game.turn} turns remaining)</div>
                            <div class="progress-bar-construct">
                                <div class="progress-fill-construct" style="width: ${Math.min(progress, 100)}%"></div>
                            </div>
                        </div>
                    `;
                });
                queueContainer.innerHTML = queueHtml;
            } else {
                queueContainer.innerHTML = '<p style="opacity: 0.6;">No ships under construction</p>';
            }
            
            // Update available ship types
            const shipTypesContainer = document.getElementById('ship-types-list');
            shipTypesContainer.innerHTML = '';
            
            for (const [key, ship] of Object.entries(game.starshipTypes)) {
                const canBuild = game.canBuildShip(key);
                const reqsMet = checkShipRequirements(key);
                
                const shipDiv = document.createElement('div');
                shipDiv.className = `building-item ${!reqsMet ? 'locked' : ''}`;
                
                let reqText = '';
                if (ship.unlockRequirements) {
                    const reqs = [];
                    for (const [req, value] of Object.entries(ship.unlockRequirements)) {
                        if (req === 'population') {
                            reqs.push(`Population: ${value} ${game.resources.population >= value ? '‚úì' : '‚úó'}`);
                        } else if (req === 'colonizedPlanets') {
                            reqs.push(`Planets: ${value} ${game.ownedPlanets.length >= value ? '‚úì' : '‚úó'}`);
                        }
                    }
                    if (reqs.length > 0) {
                        reqText = `<div class="building-effects">Requirements: ${reqs.join(', ')}</div>`;
                    }
                }
                
                shipDiv.innerHTML = `
                    <div class="building-header">
                        <span class="building-name">${ship.icon} ${ship.name}</span>
                    </div>
                    <div class="building-description">${ship.description}</div>
                    <div class="building-costs">
                        <span>üí∞ ${ship.cost.credits} Credits</span>
                        <span>üî© ${ship.cost.metals} Metals</span>
                        <span>‚ö° ${ship.cost.energy} Energy</span>
                    </div>
                    <div class="building-effects">
                        Speed: ${ship.speed} | Cargo: ${ship.cargoCapacity} | Combat: ${ship.combatPower}
                    </div>
                    <div class="building-effects">Build Time: ${ship.buildTime} turns</div>
                    ${reqText}
                    <div class="building-actions">
                        <button class="btn btn-buy" ${canBuild && reqsMet ? '' : 'disabled'} 
                                onclick="game.buildShip('${key}'); updateUI(); updateFleetTab();">
                            ${!reqsMet ? 'üîí Locked' : !canBuild ? 'üí∞ Cannot Afford' : 'Build'}
                        </button>
                    </div>
                `;
                
                shipTypesContainer.appendChild(shipDiv);
            }
            
            // Update fleet list
            const fleetContainer = document.getElementById('fleet-list');
            fleetContainer.innerHTML = '';
            
            if (game.starships.length === 0) {
                fleetContainer.innerHTML = '<p style="opacity: 0.6;">No ships in fleet. Build ships in the shipyard above.</p>';
                return;
            }
            
            game.starships.forEach(ship => {
                const shipCard = document.createElement('div');
                shipCard.className = `ship-card ${ship.traveling ? 'traveling' : ''}`;
                
                const currentSystem = game.galaxyMap.systems.find(s => s.id === ship.currentLocation);
                const systemName = currentSystem ? currentSystem.name : 'Unknown';
                
                shipCard.innerHTML = `
                    <div style="display: flex; justify-content: space-between; align-items: center;">
                        <h3>${ship.icon} ${ship.name || ship.type}</h3>
                        <span style="opacity: 0.8;">Lvl ${ship.level}</span>
                    </div>
                    <div style="margin: 10px 0;">
                        <strong>Type:</strong> ${game.starshipTypes[ship.type].name}<br>
                        <strong>Location:</strong> ${systemName}<br>
                        <strong>Status:</strong> ${ship.traveling ? `üöÄ Traveling (arrives turn ${ship.arrivalTurn})` : '‚úì Ready'}<br>
                        <strong>Health:</strong> ${ship.health}%
                    </div>
                    <div style="display: grid; grid-template-columns: repeat(2, 1fr); gap: 5px; font-size: 0.9em;">
                        <div>Speed: ${ship.speed}</div>
                        <div>Combat: ${ship.combatPower}</div>
                        <div>Cargo: ${ship.cargoCapacity}</div>
                        <div>Level: ${ship.level}</div>
                    </div>
                `;
                
                fleetContainer.appendChild(shipCard);
            });
        }

        function checkShipRequirements(shipType) {
            const ship = game.starshipTypes[shipType];
            if (!ship.unlockRequirements) return true;
            
            for (const [req, value] of Object.entries(ship.unlockRequirements)) {
                if (req === 'population' && game.resources.population < value) return false;
                if (req === 'colonizedPlanets' && game.ownedPlanets.length < value) return false;
            }
            return true;
        }

        function updatePlanetsTab() {
            const container = document.getElementById('planets-list');
            container.innerHTML = '';
            
            if (game.ownedPlanets.length === 0) {
                container.innerHTML = '<p style="opacity: 0.6;">No colonized planets yet</p>';
                return;
            }
            
            game.ownedPlanets.forEach((planetData, index) => {
                const system = game.galaxyMap.systems.find(s => s.id === planetData.systemId);
                const planet = system ? system.planets.find(p => p.id === planetData.planetId) : null;
                
                if (!planet) return;
                
                const planetDiv = document.createElement('div');
                planetDiv.className = 'planet-card';
                if (index === selectedPlanetIndex) {
                    planetDiv.classList.add('selected');
                }
                
                const planetType = game.planetTypes[planet.type];
                
                planetDiv.innerHTML = `
                    <h3>${planetType.icon} ${planet.name}</h3>
                    <p><strong>System:</strong> ${system.name}</p>
                    <p><strong>Type:</strong> ${planetType.name}</p>
                    <div style="margin: 10px 0;">
                        <strong>Resources:</strong><br>
                        üí∞ Credits: ${Math.floor(planetData.resources.credits)}<br>
                        ‚ö° Energy: ${Math.floor(planetData.resources.energy)}<br>
                        üî© Metals: ${Math.floor(planetData.resources.metals)}<br>
                        üë• Population: ${Math.floor(planetData.resources.population)}
                    </div>
                    <div style="margin: 10px 0;">
                        <strong>Environment:</strong><br>
                        üå°Ô∏è Temp: ${planetData.planetState.temperature.toFixed(1)}¬∞C<br>
                        üí® O2: ${planetData.planetState.oxygen.toFixed(1)}%<br>
                        üíß Water: ${planetData.planetState.water.toFixed(1)}%
                    </div>
                    <div style="margin-top: 10px;">
                        <button class="btn btn-primary" onclick="selectedPlanetIndex=${index}; updatePlanetsTab();">
                            ${index === selectedPlanetIndex ? '‚úì Selected' : 'Select'}
                        </button>
                        <button class="btn btn-secondary" onclick="buildDefenseForPlanet(${index})">
                            üõ°Ô∏è Build Defense
                        </button>
                    </div>
                    ${planet.defenseLevel ? `<div style="margin-top: 5px; color: #4CAF50;">Defense Level: ${planet.defenseLevel}</div>` : ''}
                `;
                
                container.appendChild(planetDiv);
            });
        }

        function buildDefenseForPlanet(planetIndex) {
            const options = ['shieldGenerator', 'plasmaCannon', 'orbitalPlatform'];
            const choice = prompt('Choose defense:\n1. Shield Generator (5000 credits, +10 defense)\n2. Plasma Cannon (8000 credits, +15 defense)\n3. Orbital Platform (15000 credits, +25 defense)\n\nEnter 1, 2, or 3:');
            
            if (choice && choice >= '1' && choice <= '3') {
                game.buildDefense(planetIndex, options[parseInt(choice) - 1]);
                updateUI();
                updatePlanetsTab();
            }
        }

        function updateDiplomacyTab() {
            // Simulate some AI players for demonstration
            if (game.otherPlayers.length === 0) {
                game.otherPlayers = [
                    { id: 'ai_player_1', name: 'Commander Azure', planets: 3, military: 15 },
                    { id: 'ai_player_2', name: 'Admiral Crimson', planets: 5, military: 25 },
                    { id: 'ai_player_3', name: 'Explorer Jade', planets: 2, military: 8 }
                ];
                
                // Initialize diplomacy
                game.otherPlayers.forEach(player => {
                    game.initializeDiplomacy(player.id);
                    game.diplomacy[player.id].opinion = Math.floor(Math.random() * 100) - 50;
                });
            }
            
            const container = document.getElementById('diplomacy-list');
            container.innerHTML = '';
            
            game.otherPlayers.forEach(player => {
                game.initializeDiplomacy(player.id);
                const relation = game.diplomacy[player.id];
                
                const playerCard = document.createElement('div');
                playerCard.className = `player-card ${relation.status}`;
                
                playerCard.innerHTML = `
                    <h3>${player.name}</h3>
                    <p><strong>Status:</strong> ${relation.status}</p>
                    <p><strong>Opinion:</strong> ${relation.opinion} ${getOpinionEmoji(relation.opinion)}</p>
                    <p><strong>Planets:</strong> ${player.planets}</p>
                    <p><strong>Military:</strong> ${player.military} ships</p>
                    
                    <div style="margin-top: 15px; display: grid; gap: 5px;">
                        <button class="btn btn-secondary btn-small" onclick="game.proposeTreaty('${player.id}', 'trade'); updateUI(); updateDiplomacyTab();">
                            üí± Trade Agreement
                        </button>
                        <button class="btn btn-secondary btn-small" onclick="game.proposeTreaty('${player.id}', 'nonAggression'); updateUI(); updateDiplomacyTab();">
                            ü§ù Non-Aggression
                        </button>
                        <button class="btn btn-secondary btn-small" onclick="game.proposeTreaty('${player.id}', 'alliance'); updateUI(); updateDiplomacyTab();">
                            üõ°Ô∏è Alliance
                        </button>
                        ${relation.status === 'war' ? 
                            `<button class="btn btn-primary btn-small" onclick="game.proposeTreaty('${player.id}', 'peace'); updateUI(); updateDiplomacyTab();">
                                ‚òÆÔ∏è Propose Peace
                            </button>` :
                            ''
                        }
                    </div>
                    
                    ${relation.tradeAgreement ? '<div style="margin-top: 10px; color: #4CAF50;">‚úì Trade Agreement Active</div>' : ''}
                    ${relation.nonAggressionPact ? '<div style="margin-top: 5px; color: #4CAF50;">‚úì Non-Aggression Pact</div>' : ''}
                `;
                
                container.appendChild(playerCard);
            });
            
            // Update invasion options
            updateInvasionOptions();
        }

        function getOpinionEmoji(opinion) {
            if (opinion > 50) return 'üòä';
            if (opinion > 0) return 'üôÇ';
            if (opinion > -50) return 'üòê';
            return 'üò†';
        }

        function updateInvasionOptions() {
            const container = document.getElementById('invasion-options');
            
            if (!game.canInvadePlanet()) {
                container.innerHTML = '<p style="color: #FF9800;">‚ö†Ô∏è Colonize at least 2 planets to unlock invasion capabilities</p>';
                return;
            }
            
            container.innerHTML = `
                <p style="color: #4CAF50;">‚úì Invasion capability unlocked</p>
                <p>Warships available: ${game.starships.filter(s => s.type === 'warship').length}</p>
                <button class="btn btn-primary" onclick="launchInvasionDialog()">
                    ‚öîÔ∏è Launch Invasion
                </button>
            `;
        }

        function launchInvasionDialog() {
            if (game.starships.filter(s => s.type === 'warship').length === 0) {
                alert('No warships available! Build warships first.');
                return;
            }
            
            // For demonstration, target first AI player
            const targetPlayer = game.otherPlayers[0];
            
            if (confirm(`Launch invasion against ${targetPlayer.name}?\n\nCost: 10,000 credits, 5,000 metals\nRisk: High casualties possible\n\nContinue?`)) {
                // Simulate invasion on a random planet in a discovered system
                const discoveredSystems = game.galaxyMap.systems.filter(s => s.discovered);
                if (discoveredSystems.length > 1) {
                    const targetSystem = discoveredSystems[1];
                    if (targetSystem.planets.length > 0) {
                        const targetPlanet = targetSystem.planets[0];
                        // Simulate that this planet is owned by the target player
                        targetPlanet.owner = targetPlayer.id;
                        targetPlanet.colonized = true;
                        targetPlanet.defenseLevel = 15;
                        
                        game.launchInvasion(targetPlayer.id, targetSystem.id, targetPlanet.id);
                    }
                }
                updateUI();
                updateFleetTab();
                updateDiplomacyTab();
            }
        }

        function updateMegaProjectsTab() {
            // Active mega-projects
            const activeContainer = document.getElementById('active-megaprojects');
            if (game.megaProjects.length > 0) {
                let html = '';
                game.megaProjects.forEach(project => {
                    const progress = ((game.turn - (project.completionTurn - project.buildTime)) / project.buildTime) * 100;
                    html += `
                        <div class="mega-project-card">
                            <h3>${project.name}</h3>
                            <p>${project.effect}</p>
                            <p><strong>Completion:</strong> Turn ${project.completionTurn} (${project.completionTurn - game.turn} turns remaining)</p>
                            <div class="progress-bar-construct">
                                <div class="progress-fill-construct" style="width: ${Math.min(progress, 100)}%"></div>
                            </div>
                        </div>
                    `;
                });
                activeContainer.innerHTML = html;
            } else {
                activeContainer.innerHTML = '<p style="opacity: 0.6;">No mega-projects currently under construction</p>';
            }
            
            // Available mega-projects
            const optionsContainer = document.getElementById('megaproject-options');
            const projects = [
                {
                    key: 'dysonSphere',
                    name: 'Dyson Sphere',
                    desc: 'Unlimited energy production',
                    cost: '100k credits, 50k metals, 1k rare',
                    time: '50 turns',
                    req: '5 planets'
                },
                {
                    key: 'ringWorld',
                    name: 'Ring World',
                    desc: 'Massive population capacity',
                    cost: '150k credits, 80k metals, 2k rare',
                    time: '75 turns',
                    req: '8 planets'
                },
                {
                    key: 'wormholeGate',
                    name: 'Wormhole Gate',
                    desc: 'Instant travel between systems',
                    cost: '80k credits, 40k metals, 1.5k rare',
                    time: '40 turns',
                    req: '4 planets'
                }
            ];
            
            let html = '<div style="display: grid; gap: 15px;">';
            projects.forEach(project => {
                html += `
                    <div style="background: #16213e; padding: 20px; border-radius: 8px;">
                        <h3>${project.name}</h3>
                        <p>${project.desc}</p>
                        <p><strong>Cost:</strong> ${project.cost}</p>
                        <p><strong>Build Time:</strong> ${project.time}</p>
                        <p><strong>Requirements:</strong> ${project.req}</p>
                        <button class="btn btn-primary" onclick="game.startMegaProject('${project.key}'); updateUI(); updateMegaProjectsTab();">
                            Start Construction
                        </button>
                    </div>
                `;
            });
            html += '</div>';
            optionsContainer.innerHTML = html;
        }

        function showTradeRouteDialog() {
            if (game.ownedPlanets.length < 2) {
                alert('Need at least 2 planets to establish trade routes');
                return;
            }
            
            alert('Trade route system: Select source and destination planets, then choose resource type and amount. (Full UI implementation would go here)');
        }

        // Initialize game
        window.addEventListener('DOMContentLoaded', () => {
            game = new MultiplayerGame();
            
            // Setup event listeners
            document.getElementById('mp-next-turn').addEventListener('click', () => {
                game.nextTurn();
                updateUI();
                
                // Update current tab
                const activeTab = document.querySelector('.tab-content.active');
                if (activeTab) {
                    const tabName = activeTab.id.replace('-tab', '');
                    if (tabName === 'fleet') updateFleetTab();
                    if (tabName === 'planets') updatePlanetsTab();
                    if (tabName === 'diplomacy') updateDiplomacyTab();
                    if (tabName === 'megaprojects') updateMegaProjectsTab();
                    if (tabName === 'overview') updateOverviewTab();
                }
            });
            
            document.getElementById('mp-save').addEventListener('click', () => {
                game.saveGameState();
                alert('Game saved successfully!');
            });
            
            document.getElementById('mp-reset').addEventListener('click', () => {
                if (confirm('Start a new game? All progress will be lost.')) {
                    localStorage.removeItem('genesisFrontierSave');
                    location.reload();
                }
            });
            
            updateUI();
            updateOverviewTab();
        });
    </script>
</body>
</html>
